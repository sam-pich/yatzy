<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <title>Yatzy Game</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#version').click(function() {
                $.ajax({
                    url: '/api/version',
                    method: 'GET',
                    success: function(data) {
                        $('#output').html(data.version);
                    },
                    error: function() {
                        $('#output').html('Error fetching version');
                    }
                });
            });

            $('#roll').click(function() {
                $.ajax({
                    url: '/api/roll',
                    method: 'GET',
                    success: function(data) {
                        let roll = data.roll;
                        let diceContainer = $('#dice-container');

                        diceContainer.empty();

                        roll.forEach(function(num) {
                            let dice = $('<img>').attr('src', 'assets/d' + num + '.svg').addClass('dice');
                            diceContainer.append(dice);
                        });
                        $('#output').html('Roll: ' + roll.join(', '));
                    },
                    error: function() {
                        $('#output').html('Error getting roll');
                    }
                });
            });

            function updateLeaderboard() {
                $.ajax({
                    url: '/api/leaderboard',
                    method: 'GET',
                    success: function(data) {
                        let leaderboard = data.leaderboard;
                        let tbody = $('#leaderboard-body');

                        tbody.empty();

                        leaderboard.forEach(function(entry) {
                            let row = $('<tr>');

                            row.append($('<td>').text(entry.player));
                            row.append($('<td>').text(entry.score));
                            tbody.append(row);
                        });
                    },
                    error: function() {
                        $('#output').html('Error getting leaderboard');
                    }
                });
            }

            $('#submit-score').click(function() {
                let player = $('#player-name').val();
                let score = $('#player-score').val();

                $.ajax({
                    url: '/api/leaderboard',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ player: player, score: score }),
                    success: function() {
                        updateLeaderboard();
                    },
                    error: function() {
                        $('#output').html('Error submitting score');
                    }
                });
            });

            $('#clear-leaderboard').click(function() {
                $.ajax({
                    url: '/api/leaderboard/clear',
                    method: 'POST',
                    success: function() {
                        updateLeaderboard();
                    },
                    error: function() {
                        $('#output').html('Error clearing leaderboard');
                    }
                });
            });

            // init leaderboard
            updateLeaderboard();
        });
    </script>
</head>
<body>
<div class="container">
    <div id="game">
        <h1>Yatzy Game</h1>
        <button id="version">Check Version</button>
        <button id="roll">Roll Dice</button>
        <div id="output"></div>
        <div id="dice-container"></div>
    </div>
    <div id="leaderboard-section">
        <div id="leaderboard">
            <h1>Leaderboard</h1>
            <table>
                <thead>
                <tr>
                    <th>Player</th>
                    <th>Score</th>
                </tr>
                </thead>
                <tbody id="leaderboard-body">
                <!-- leaderboard gets populated here -->
                </tbody>
            </table>
        </div>
        <div id="submit-score-form">
            <h1>Submit Score</h1>
            <input type="text" id="player-name" placeholder="Player Name">
            <input type="text" id="player-score" placeholder="Player Score">
            <button id="submit-score">Submit Score</button>
            <button id="clear-leaderboard">Clear Leaderboard</button>
        </div>
    </div>
</div>
</body>
</html>